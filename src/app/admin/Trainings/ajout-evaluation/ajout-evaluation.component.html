<app-sidebar></app-sidebar>
<div id="content">
  <div class="competition-container">
    <div class="card">
      <form [formGroup]="evaluationForm" (ngSubmit)="onSubmit()" class="post-form">
        <h2>
          <span class="title-icon">ğŸ“</span> CrÃ©er une Ã‰valuation
        </h2>

        <!-- DÃ©tails de l'Ã©valuation -->
        <div class="form-group">
          <label for="description">Description de l'Ã©valuation :</label>
          <input 
            id="description" 
            type="text" 
            formControlName="description" 
            placeholder="Description de l'Ã©valuation" 
            required />
          <span class="input-icon">âœï¸</span>
        </div>

        <div class="form-group">
          <label for="evaluation_duration">DurÃ©e (minutes) :</label>
          <input 
            id="evaluation_duration" 
            type="number" 
            formControlName="evaluation_duration" 
            placeholder="DurÃ©e en minutes" 
            required />
          <span class="input-icon">â±ï¸</span>
        </div>

        <div class="form-group">
          <label for="training_id">Training :</label>
          <select id="training_id" formControlName="training_id" required>
            <option value="">SÃ©lectionner un training</option>
            <option *ngFor="let training of trainings" [value]="training.idTraining">
              {{ training.title }}
            </option>
          </select>
          <span class="input-icon">ğŸ‹ï¸</span>
        </div>
        
        <div class="form-group">
          <label for="score">Score minimal :</label>
          <input 
            id="score" 
            type="number" 
            formControlName="score" 
            placeholder="Score minimal" 
            required />
          <span class="input-icon">â­</span>
        </div>

        <div class="form-group">
          <label for="type">Type :</label>
          <select id="type" formControlName="type">
            <option value="">SÃ©lectionner un type</option>
            <option value="QCM">QCM</option>
            <option value="Ouverte">Ouverte</option>
          </select>
          <span class="input-icon">ğŸ“‹</span>
        </div>

        <!-- Questions Section -->
        <h3><span class="section-icon">â“</span> Questions</h3>
        <div formArrayName="questions" class="questions-container">
          <div *ngFor="let question of questions.controls; let i = index" [formGroupName]="i" class="question-box">
            <div class="form-group">
              <label>Question {{ i + 1 }} :</label>
              <input 
                type="text" 
                formControlName="question_text" 
                placeholder="Texte de la question" 
                required />
              <span class="input-icon">ğŸ“œ</span>
            </div>

            <div class="form-group">
              <label>RÃ©ponse Correcte :</label>
              <input 
                type="text" 
                formControlName="correct_answer" 
                placeholder="RÃ©ponse correcte" 
                required />
              <span class="input-icon">âœ…</span>
            </div>

            <h4><span class="section-icon">ğŸ”˜</span> Options</h4>
            <div formArrayName="options" class="options-container">
              <div *ngFor="let option of getOptionsControls(i).controls; let j = index" [formGroupName]="j" class="option-group">
                <input 
                  type="text" 
                  formControlName="option_text" 
                  placeholder="Option" />
                <button type="button" class="btn-remove" (click)="removeOption(i, j)">
                  <span class="btn-icon">âŒ</span>
                </button>
              </div>
            </div>

            <div class="question-actions">
              <button type="button" class="btn-small" (click)="addOption(i)">
                <span class="btn-icon">â•</span> Ajouter une option
              </button>
              <button type="button" class="btn-small delete" (click)="removeQuestion(i)">
                <span class="btn-icon">âŒ</span> Supprimer Question
              </button>
            </div>
          </div>
        </div>

        <!-- Form Actions -->
        <div class="button-container">
          <button type="button" class="btn-primary" (click)="addQuestion()">
            <span class="button-icon">â•</span> Ajouter une Question
          </button>
          <button type="submit" class="btn-primary submit" >
            <span class="button-icon">âœ…</span> Enregistrer l'Ã‰valuation
          </button>
        </div>

        <p *ngIf="isSubmitted" class="success-message">{{ successMessage }}</p>
      </form>
    </div>
  </div>
</div>